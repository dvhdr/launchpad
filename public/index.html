<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<title>Launchpad Remix Machine</title>

<link rel="stylesheet" href="css/main.css" type="text/css">

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src='http://cwilso.github.com/WebMIDIAPIShim/WebMIDIAPI.js'></script>
<script src="js/midi.js"></script>
<script src='js/remix.js'></script>

</head>

<body>

<script type="text/javascript">

    // These are the things you need:  an API key, the track ID, and the path to the track
    var apiKey = 'PGCZJJWKLITVGDF9Q';
    var trackID = 'TRCYWPQ139279B3308';
    var trackURL = 'audio/test.mp3';
    
    // Set up the key variables
    var remixer;
    var player;
    var track;

// The main function.
function init() 
{
    var myText = document.getElementById("helloText");

    // Make sure the browser supports Web Audio.
    if (window.webkitAudioContext === undefined) 
    {
        myText.textContent = "Web Audio is missing :(";
    } 
    else 
    {    
        myText.textContent = "Launchpad Remix Machine";
    
        // These set up the WebAudio playback environment, and create the remixer and player.
        var context = new webkitAudioContext();
        remixer = createJRemixer(context, $, apiKey);
        player = remixer.getPlayer();
        $("#info").text("Loading analysis data...");

        // The key line.  This prepares the track for remixing:  it gets
        // data from the Echo Nest analyze API and connects it with the audio file.
        // All the remixing takes place in the callback function.
        remixer.remixTrackById(trackID, trackURL, function(t, percent)
        {
            track = t;

            // Keep the user update with load times
            $("#info").text(percent + "% of the track loaded");
            if (percent == 100) {
                $("#info").text(percent + "% of the track loaded, remixing... (" + track.status + ")");
            }
                
            // Do the remixing!
            if (track.status == 'ok') 
            {
                $("#info").text("Remix ready! " + track.analysis.beats.length + " beats, "  + track.analysis.tatums.length + " tatums");
            }
            
        });
    }
}

// Run the main function once the page is loaded.
window.onload = init;

function playClip(x, y) 
{
    var yoff = y * 32;

    if (x < 4)
    {
        var xoff = x * 4;
        
        var bar = new Array();
        
        for (var i=0; i < 8; ++i)
        {
            bar.push(track.analysis.beats[yoff + xoff + 0]);
            bar.push(track.analysis.beats[yoff + xoff + 1]);
            bar.push(track.analysis.beats[yoff + xoff + 2]);
            bar.push(track.analysis.beats[yoff + xoff + 3]);
        }
        player.stop();
        var playres = player.play(0, bar);
    }
    else
    {
        var xoff = (x-4) * 4;
        
        var bar = new Array();
        for (var i=0; i < 16; ++i)
        {
            bar.push(track.analysis.tatums[yoff + xoff]);
        }
        
        player.stop();
        var playres = player.play(0, bar);
    }
}

</script>

<div id="mainContent">
<p id="helloText">?</p>
</div>

<div id='info'> </div>

<div id="universe">

    </div>
	<p>
		MIDI Input:
		<select id=midiIn onchange='changeMidiIn();'>
			<option value="">Not connected</option>
		</select>
		MIDI Output:
		<select id=midiOut onchange='changeMidiOut();'>
			<option value="">Not connected</option>
		</select>
	</p>
    
<button onClick="player.play(0, track.analysis.beats)">Play original</button>
<button onClick="player.stop()">Stop!</button>

</body>
</html>
















